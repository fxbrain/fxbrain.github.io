<!DOCTYPE html>



<html>

<head>
    <meta charset="utf-8">
    <base href="http://fxbrain.github.io/BloGo">
    <title> The Perfect Command Line Interface in Go </title>
    <link rel="canonical" href="http://fxbrain.github.io/BloGo/posts/newest/">


    <link rel="stylesheet" href="https://fxbrain.github.io/BloGo/css/poole.css">
    <link rel="stylesheet" href="https://fxbrain.github.io/BloGo/css/syntax.css">
    <link rel="stylesheet" href="https://fxbrain.github.io/BloGo/css/lanyon.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
</head>


<body class="theme-base-08">



    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


    <div class="sidebar" id="sidebar">

        <nav class="sidebar-nav">
            <a class="sidebar-nav-item" href="http://fxbrain.github.io/BloGo/">Home</a>

            <a class="sidebar-nav-item" href="http://fxbrain.github.io/BloGo/posts">Blog</a>
        </nav>

        <div class="sidebar-item">
            <p>
                &copy; 2015 Stefan Schwarz. Powered by <a href="http://hugo.spf13.com">Hugo</a>.
            </p>
        </div>
    </div>


    <div class="wrap">
        <div class="masthead">
            <div class="container">
                <h3 class="masthead-title">
          <a href="http://fxbrain.github.io/BloGo/posts" title="Blog">Blog Posts</a>
        </h3>
            </div>
        </div>


        <div class="container content">
            <h1 class="post-title">The Perfect Command Line Interface in Go</h1>
            <section id="main">
                <h5 id="date"> Tue Jun 9, 2015 </h5>


                <h2 id="introduction:912493bb798d2cf24137bef8b4adb6f6">Introduction</h2>

                <p>There were times where a command line interface (CLI) seemed to be extinct, but due to the emerge of tools like <em>Node.js</em> and <em>Go</em> the CLI got a revitalisation.</p>

                <p>A careful crafted CLI can be a powerful tool to an application.</p>

                <p>In this article I&rsquo;d like to describe how I implemented a CLI library which fulfilled my specific needs perfectly.</p>

                <p>While there are many options to choose, when in Node.js for a CLI I was not happy with the current state of affair considering Go.</p>

                <h2 id="architecture:912493bb798d2cf24137bef8b4adb6f6">Architecture</h2>

                <p>Basically the idea was this. I wanted to develop a container where commands can register itself to get listed with their specific description and can be executed.</p>

                <p>These commands I&rsquo;ll call for now a <em>subcommand</em>.</p>

                <p>Every subcommand must fulfill the following interface: 1. Initialisation during init() with <em>RegisterCommand</em> 2. A <em>Usage</em> function 3. A <em>RunCommand</em> function 4. In order to get listed as a subcommand it must provide a <em>Description</em> function 5. If the subcommand want to display several examples of its usage it must provide a
                    <em>Examples</em> function</p>

                <h2 id="the-container:912493bb798d2cf24137bef8b4adb6f6">The Container</h2>

                <pre><code class="language-go">package cmdmain

var (
	FlagVersion = flag.Bool(&quot;version&quot;, false, &quot;show version&quot;)
	FlagHelp    = flag.Bool(&quot;help&quot;, false, &quot;print usage&quot;)
	FlagVerbose = flag.Bool(&quot;verbose&quot;, false, &quot;extra debug logging&quot;)
)

var (
	ExtraFlagRegistration = func() {}
	PreExit = func() {}
	ExitWithFailure bool
	CheckCwd = func() {}
	CheckModtime = func() error { return nil }
)
</code></pre>

                <pre><code class="language-go">var (
	modeCommand = make(map[string]CommandRunner)
	modeFlags   = make(map[string]*flag.FlagSet)
	wantHelp    = make(map[string]*bool)

	Stderr io.Writer = os.Stderr
	Stdout io.Writer = os.Stdout
	Stdin  io.Reader = os.Stdin

	Exit = realExit

)
</code></pre>

                <pre><code class="language-go">type CommandRunner interface {
	Usage()
	RunCommand(args []string) error


type exampler interface {
	Examples() []string
}
type describer interface {
	Describe() string
}
</code></pre>

                <pre><code class="language-go">func RegisterCommand(mode string, makeCmd func(Flags *flag.FlagSet)
                     CommandRunner) {
	if _, dup := modeCommand[mode]; dup {
		log.Fatalf(&quot;duplicate command %q registered&quot;, mode)
	}
	flags := flag.NewFlagSet(mode+&quot; options&quot;, flag.ContinueOnError)
	flags.Usage = func() {}

	var cmdHelp bool
	flags.BoolVar(&amp;cmdHelp, &quot;help&quot;, false, &quot;Help for this mode.&quot;)
	wantHelp[mode] = &amp;cmdHelp
	modeFlags[mode] = flags
	modeCommand[mode] = makeCmd(flags)
}
</code></pre>

                <h2 id="a-subcommand:912493bb798d2cf24137bef8b4adb6f6">A Subcommand</h2>

                <p>The following subcommand implementation is in its functionality very similar to the Node.js <em>http-server</em> module. It serves static files through http.</p>

                <pre><code class="language-go">package main
</code></pre>

                <pre><code class="language-go">type serveCmd struct {
	address string
	port    string
}
</code></pre>

                <pre><code class="language-go">func init() {
	cmdmain.RegisterCommand(&quot;serve&quot;, func(flags *flag.FlagSet) cmdmain.CommandRunner {
		cmd := new(serveCmd)
		flags.StringVar(&amp;cmd.address, &quot;address&quot;, &quot;localhost&quot;, &quot;host address.&quot;)
		flags.StringVar(&amp;cmd.port, &quot;port&quot;, &quot;&quot;, &quot;host port.&quot;)
		return cmd
	})
}
</code></pre>

                <pre><code class="language-go">func (c *serveCmd) Describe() string {
	return &quot;Run a http server from address:port&quot;
}

func (c *serveCmd) Usage() {
	fmt.Fprintf(os.Stderr, &quot;Usage: cmdtool [globalopts] serve [--host] [--port]\n&quot;)
}

func (c *serveCmd) Examples() []string {
	return nil
}
</code></pre>

                <pre><code class="language-go">func (c *serveCmd) RunCommand(args []string) error {
	if c.port == &quot;&quot; {
		return cmdmain.UsageError(&quot;--port flag is required.&quot;)
	}
	fmt.Println(chalk.Yellow, &quot;Starting up http-server, serving &quot;, chalk.Reset,
		chalk.Cyan, &quot;./&quot;, chalk.Reset, chalk.Yellow, &quot; on &quot;, chalk.Reset, chalk.Cyan,
		&quot;http://0.0.0.0:&quot;+c.port, chalk.Reset)
	http.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;.&quot;)))
	http.ListenAndServe(c.address+&quot;:&quot;+c.port, nil)
	return nil
}
</code></pre>

            </section>
        </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>



    <div class="container">
        <hr />
        <hr />



    </div>

    <br />

    <div class="container">
        <ul class="catlist">
            <li><em>Categories: </em></li>

            <li><a href="http://fxbrain.github.io/BloGo/categories/go">Go</a> </li>

            <li><a href="http://fxbrain.github.io/BloGo/categories/cli">CLI</a> </li>

        </ul>
    </div>






    <div class="container content">
        <footer>
            <div>
                <p class="right credit">
                    Stefan Schwarz &mdash; @TypeFx.

                </p>
            </div>
        </footer>
    </div>


    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-36732392-2', 'sglyon.com');
        ga('send', 'pageview');
    </script>


</body>

</html>